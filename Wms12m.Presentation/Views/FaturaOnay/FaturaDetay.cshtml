@model FaturaDetayData
@{
    ViewBag.Title = "FaturaDetay";
}@section Styles{
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/assets/global/plugins/devextreme/css/dx.common.min.css" rel="stylesheet" />
    <link href="~/Content/assets/global/plugins/devextreme/css/dx.light.min.css" rel="stylesheet" />
    <link href="~/Content/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" />
    <link href="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" />
    <link href="~/Content/assets/pages/css/invoice.min.css" rel="stylesheet" />


}
<style>
    table th {
        width: auto !important;
    }

    .list-unstyled.amounts li {
        font-size: 9px;
        text-align: left;
        float: left;
    }

    .list-unstyled.genel strong {
        color: rgba(230, 94, 138, 0.95);
    }

    .invoice-payment.genel h3 {
        color: rgba(9, 208, 241, 0.65);
        font-weight: bold;
    }
</style>

@*<div class="theme-panel hidden-xs hidden-sm">
        <div class="toggler"> </div>
        <div class="toggler-close"> </div>
        <div class="theme-options">
            <div class="theme-option theme-colors clearfix">
                <span> THEME COLOR </span>
                <ul>
                    <li class="color-default current tooltips" data-style="default" data-container="body" data-original-title="Default"> </li>
                    <li class="color-darkblue tooltips" data-style="darkblue" data-container="body" data-original-title="Dark Blue"> </li>
                    <li class="color-blue tooltips" data-style="blue" data-container="body" data-original-title="Blue"> </li>
                    <li class="color-grey tooltips" data-style="grey" data-container="body" data-original-title="Grey"> </li>
                    <li class="color-light tooltips" data-style="light" data-container="body" data-original-title="Light"> </li>
                    <li class="color-light2 tooltips" data-style="light2" data-container="body" data-html="true" data-original-title="Light 2"> </li>
                </ul>
            </div>
            <div class="theme-option">
                <span> Theme Style </span>
                <select class="layout-style-option form-control input-sm">
                    <option value="square" selected="selected">Square corners</option>
                    <option value="rounded">Rounded corners</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Layout </span>
                <select class="layout-option form-control input-sm">
                    <option value="fluid" selected="selected">Fluid</option>
                    <option value="boxed">Boxed</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Header </span>
                <select class="page-header-option form-control input-sm">
                    <option value="fixed" selected="selected">Fixed</option>
                    <option value="default">Default</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Top Menu Dropdown</span>
                <select class="page-header-top-dropdown-style-option form-control input-sm">
                    <option value="light" selected="selected">Light</option>
                    <option value="dark">Dark</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Sidebar Mode</span>
                <select class="sidebar-option form-control input-sm">
                    <option value="fixed">Fixed</option>
                    <option value="default" selected="selected">Default</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Sidebar Menu </span>
                <select class="sidebar-menu-option form-control input-sm">
                    <option value="accordion" selected="selected">Accordion</option>
                    <option value="hover">Hover</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Sidebar Style </span>
                <select class="sidebar-style-option form-control input-sm">
                    <option value="default" selected="selected">Default</option>
                    <option value="light">Light</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Sidebar Position </span>
                <select class="sidebar-pos-option form-control input-sm">
                    <option value="left" selected="selected">Left</option>
                    <option value="right">Right</option>
                </select>
            </div>
            <div class="theme-option">
                <span> Footer </span>
                <select class="page-footer-option form-control input-sm">
                    <option value="fixed">Fixed</option>
                    <option value="default" selected="selected">Default</option>
                </select>
            </div>
        </div>
    </div>*@
<!-- END THEME PANEL -->
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    @*<ul class="page-breadcrumb">
            <li>
                <a href="index.html">Home</a>
                <i class="fa fa-circle"></i>
            </li>
            <li>
                <span>General</span>
            </li>
        </ul>
        <div class="page-toolbar">
            <div class="btn-group pull-right">
                <button type="button" class="btn green btn-sm btn-outline dropdown-toggle" data-toggle="dropdown">
                    Actions
                    <i class="fa fa-angle-down"></i>
                </button>
                <ul class="dropdown-menu pull-right" role="menu">
                    <li>
                        <a href="#">
                            <i class="icon-bell"></i> Action
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-shield"></i> Another action
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-user"></i> Something else here
                        </a>
                    </li>
                    <li class="divider"> </li>
                    <li>
                        <a href="#">
                            <i class="icon-bag"></i> Separated link
                        </a>
                    </li>
                </ul>
            </div>
        </div>*@
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h1 class="page-title" style="color:#d06194;">
    Fatura Onay
    <small></small>
</h1>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->
<div class="invoice">
    <div class="row invoice-logo">
        <div class="col-xs-6 invoice-logo-space">
            <img src="~/content/assets/pages/img/VezirKoprubanner.jpg" class="img-responsive" alt="" />
        </div>
        <div class="col-xs-6">
            <p>
                @Model.GENEL[0].EvrakNo / @Model.GENEL[0].Tarih
                <span class="muted">  </span>
            </p>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-xs-4 invoice-payment genel">
            <h3>Hesap Bilgileri:</h3>
            <ul class="list-unstyled genel">
                <li>
                    <strong>Hesap Kodu:</strong> @Model.GENEL[0].Chk
                </li>
                <li>
                    <strong>Ünvan:</strong> @Model.GENEL[0].Unvan
                </li>
                <li>
                    <strong>Teslim Yeri Kodu:</strong> @Model.GENEL[0].TeslimYeriKodu
                </li>
                <li>
                    <strong>Evrak No:</strong> @Model.GENEL[0].EvrakNo
                </li>
                <li>
                    <strong>Tarih:</strong> @Model.GENEL[0].Tarih
                </li>
            </ul>
        </div>
        <div class="col-xs-4 invoice-payment genel">
            <h3>İşlem Bilgileri:</h3>
            <ul class="list-unstyled genel">
                <li>
                    <strong>İşlem Tipi:</strong> @Model.GENEL[0].IslemTip
                </li>
                <li>
                    <strong>Vade Tarihi:</strong> @Model.GENEL[0].VadeTarih
                </li>
                <li>
                    <strong>Döviz/TL:</strong> @Model.GENEL[0].DvzTL
                </li>
                <li>
                    <strong>Döviz Cinsi:</strong> @Model.GENEL[0].DovizCinsi
                </li>
                <li>
                    <strong>Döviz Kuru:</strong> @Model.GENEL[0].DovizKuru
                </li>
            </ul>
        </div>
        <div class="col-xs-4 invoice-payment genel">
            <h3>Açıklamalar:</h3>
            <ul class="list-unstyled genel">
                <li>
                    <strong>Açıklama:</strong> @Model.GENEL[0].Aciklama
                </li>
                <li>
                    <strong>Açıklama2:</strong> @Model.GENEL[0].Aciklama2
                </li>
                <li>
                    <strong>Açıklama3:</strong> @Model.GENEL[0].Aciklama3
                </li>
                <li>
                    <strong>Açıklama4:</strong> @Model.GENEL[0].Aciklama4
                </li>
                <li>
                    <strong>Açıklama5:</strong> @Model.GENEL[0].Aciklama5
                </li>
                <li>
                    <strong>Açıklama6:</strong> @Model.GENEL[0].Aciklama6
                </li>
                <li>
                    <strong>Kaydeden:</strong> @Model.GENEL[0].Kaydeden
                </li>
                <li>
                    <strong>Değiştiren:</strong> @Model.GENEL[0].Degistiren
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <table class="table table-striped table-hover" id="sample_1">
                <thead>
                    <tr style="background-color: rgba(9, 208, 241, 0.65);color:rgba(247, 238, 238, 0.85);">
                        <th> # </th>
                        <th> Mal Kodu </th>
                        <th> Mal Adı </th>
                        <th> Birim </th>
                        <th> Birim Miktar </th>
                        <th> Birim Fiyat </th>
                        <th> Tutar </th>
                        <th> Depo </th>
                        <th> KDV Oranı </th>
                        <th> KDV Muafiyet Nedeni </th>
                        <th> Döviz/TL </th>
                        <th> Döviz Cinsi </th>
                        <th> Döviz Kuru </th>
                        <th> Döviz Tutar </th>
                        <th> İskonto 1 </th>
                        <th> İskonto 2 </th>
                        <th> İskonto 3 </th>
                        <th> İskonto 4 </th>
                        <th> İskonto 5 </th>
                        <th> Net Tutar </th>
                        <th> Nesne1 </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.STI)
                    {
                    <tr>
                        <td> 1 </td>
                        <td> @item.MalKodu </td>
                        <td> @item.MalAdi  </td>
                        <td> @item.Birim  </td>
                        <td> @item.BirimMiktar  </td>
                        <td> @item.BirimFiyat  </td>
                        <td> @item.Tutar  </td>
                        <td> @item.Depo  </td>
                        <td> @item.KdvOran  </td>
                        <td> @item.KdvMuafiyetNedeni  </td>
                        <td> @item.DvzTL  </td>
                        <td> @item.DovizCinsi  </td>
                        <td> @item.DovizKuru  </td>
                        <td> @item.DovizTutar  </td>
                        <td> @item.IskontoOran1  </td>
                        <td> @item.IskontoOran2  </td>
                        <td> @item.IskontoOran3  </td>
                        <td> @item.IskontoOran4  </td>
                        <td> @item.IskontoOran5  </td>
                        <td> @item.NetTutar  </td>
                        <td> @item.Nesne1  </td>
                    </tr>
                    }

                </tbody>
            </table>
        </div>
    </div>
    <div class="row" style="font-size:9px;margin-top:20px;">
        <div class="col-xs-2 col-sm-2" style="text-align:center;">
            <div class="btn btn-lg green onayla-buton" style="width:100%; margin-bottom:10px;">Onayla<i class="fa fa-check"></i></div>
            <div class="btn btn-lg red red-buton" style="width:100%; margin-bottom:10px;">Reddet<i class="fa fa-close"></i></div>
            <div class="btn btn-lg default geri-buton" style="width:100%; margin-bottom:10px;">Geri Dön<i class="fa fa-mail-reply"></i></div>
        </div>
        <div class="col-xs-10 col-sm-10">
            <div class="well" style="display:inline-block;">
                @foreach (var item in Model.FTD)
                {
                <ul class="list-unstyled amounts" style="display: inline-block;width: 100%;">

                    <li class="col-xs-2 col-sm-2">
                        <strong sty>@item.Tip</strong>
                    </li>
                    <li class="col-xs-1 col-sm-1">
                        <strong sty>Oran</strong> @item.IskontoOran
                    </li>
                    <li class="col-xs-2 col-sm-2">
                        <strong sty>Tutar</strong> @item.Iskonto
                    </li>
                    @*<li class="col-xs-2">
                            <strong sty>KDV Muafiyet Nedeni</strong> @item.KdvMuafiyetNedeni
                        </li>*@
                    <li class="col-xs-2 col-sm-2">
                        <strong sty>Döviz/TL</strong> @item.DvzTL
                    </li>
                    <li class="col-xs-1 col-sm-1">
                        <strong sty>Döviz Cinsi</strong> @item.DovizCinsi
                    </li>
                    <li class="col-xs-2 col-sm-2">
                        <strong sty>Döviz Kuru</strong> @item.DovizKuru
                    </li>
                    <li class="col-xs-2 col-sm-2">
                        <strong sty>Döviz Tutar</strong> @item.DovizTutar
                    </li>


                </ul>
                }

            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="x-modal-faturared" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" style="color:#3434cb">Fatura Onay Red</h4>
            </div>
            <div class="modal-body x-padding-inside" id="x-t-s-pe1">
                @*<div class="silKontrol">
                        <div style="width:100%;">
                            <h5 style="color:#de3838;">Faturanın silinmesini ister misiniz?</h5>
                        </div>
                        <div>

                        </div>
                        <div class="rdgrpSil">

                        </div>
                    </div>
                    <hr />*@
                <div class="redNeden">
                    <div style="width:100%;">
                        <h5 style="color:#de3838;">
                            Red Nedeni
                        </h5>
                    </div>
                    <div class="txtRedNeden">

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="mdlSilKapat">Kapat</button>
                <button type="button" class="btn btn-primary" id="mdlSilKayit" data-dismiss="modal">Kaydet</button>
                <div class="label"></div>
            </div>
        </div>
    </div>
</div>
@section Scripts{

    <script src="~/Content/assets/global/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="~/Content/assets/global/plugins/devextreme/js/dx.web.js"></script>
    <script src="~/Content/assets/global/plugins/moment/moment.min.js"></script>
    <script src="~/Content/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    <script src="~/Content/assets/global/scripts/datatable.js"></script>
    <script src="~/Content/assets/global/plugins/datatables/datatables.min.js"></script>
    <script src="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js"></script>
    <script type="text/javascript">
        var f_evrakNo = '@ViewBag.EvrakNo';
        var f_chk= @Model.GENEL[0].Chk;
        var f_tarih= @Model.GENEL[0].Tarih;
        var check_sum = new Array();

        var model = @Html.Raw(Json.Encode(Model));
       
        model.STI.each(function( index ) {
            console.log( index + ": " + $( this ).text() );
        });

        var sayac = 1;
        $('#sample_1').DataTable({ "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json", "autoWidth": true } });

        $(document).on("ready", function () {
            $(".txtRedNeden").dxTextArea({ placeholder: 'Açıklama girin', height: 150, maxLength: '128' });
        });

        $(document).on("click", ".geri-buton", function () {
            window.location.href = '/FaturaOnay/Index';
        });
        $(document).on("click", ".onayla-buton", function () {
            ModalYesNoClick("Onaylamak istediğinize emin misiniz?", "Onay Uyarı", "Kaydet", "onayKayit", Onayla, "Kapat", "onayKapat", null);
        });
        function Onayla() {
            var _dfd = $.Deferred();
            $.ajax({
                url: window.location.origin + "/FaturaOnay/FaturaDetayOnayla",
                data: { EvrakNo: f_evrakNo, CHK: f_chk, Tarih: f_tarih },
                type: "post",
                success: function (data) {
                    if (data == "OK") {
                        //Modaldialog("İşlem Başarılı", "Güncelleme İşlemi", "Tamam", "Guncel");

                        window.location.href = '/Home/Index';
                    }
                    else if (data == "NO") {
                        Modaldialog("Kayıt sırasında hata oluştu. İşleminiz gerçekleştirilemedi.", "Güncelleme İşlemi", "Tamam", "Guncel");
                    }
                    else if (data == "DEGISIM") {
                        AL_FATURALAR(f_evrakNo);
                        Modaldialog("Faturada değişiklik tespit edildi. Fatura Durumu : Onay Bekliyor", "Güncelleme İşlemi", "Tamam", "Guncel");

                    }
                    else {
                        window.location.href = '/Home/Index';
                    }

                },
                error: function (jqxhr) { console.log(jqxhr); }
            });
            return _dfd.promise();
        }


        $(document).on("click", ".red-buton", function () {
            $(".rdgrpSil").dxRadioGroup({
                value: "Silme"
            });
            $('#x-modal-faturared').modal("show");

        });
        $(document).on("click", "#mdlSilKayit", function () {
            ModalYesNoClick("Reddetmek istediğinize emin misiniz?", "Red Uyarı", "Kaydet", "redKayit", Red, "Kapat", "redKapat", null);
        });

        function Red() {
            var _dfd = $.Deferred();
            var f_chk, f_tarih, f_evrakNo, f_redNeden;
            f_tarih = $(".Tarih").text();
            f_chk = $(".CHK").text();
            f_evrakNo = $(".EvrakNo").text();
            f_redNeden = $(".txtRedNeden").dxTextArea("instance").option("value");
            $.ajax({
                url: window.location.origin + "/Home/FaturaDetayRed",
                data: { EvrakNo: f_evrakNo, CHK: f_chk, Tarih: f_tarih, RedNeden: f_redNeden },
                type: "post",
                success: function (data) {

                    if (data == "NO") {
                        Modaldialog("Kayıt sırasında hata oluştu. İşleminiz gerçekleştirilemedi.", "Güncelleme İşlemi", "Tamam", "Guncel");
                    }
                    else if (data == "DEGISIM") {
                        AL_FATURALAR(f_evrakNo);
                        Modaldialog("Faturada değişiklik tespit edildi. Fatura Durumu : Onay Bekliyor", "Güncelleme İşlemi", "Tamam", "Guncel");

                    }
                    else {
                        Modaldialog("İşlem Başarılı", "Güncelleme İşlemi", "Tamam", "Guncel");
                        window.location.href = '/Home/Index';
                    }



                },
                error: function (jqxhr) { console.log(jqxhr); }
            });
            return _dfd.promise();
        }
    </script>
}

