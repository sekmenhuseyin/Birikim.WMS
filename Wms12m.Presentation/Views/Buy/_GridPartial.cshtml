@model List<GetIrsaliyeSTI_Result>
@using (Ajax.BeginForm("InsertMalzeme", "Buy", new { }, new AjaxOptions { InsertionMode = InsertionMode.Replace, UpdateTargetId = "StoreGrid" }, new { @class = "form-horizontal" }))
{
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>Malzeme Kodu</th>
                <th>Malzeme Adı</th>
                <th>Miktar</th>
                <th>Birim</th>
                <th>İşlem</th>
            </tr>
        </thead>
        <tbody id="StoreFrom">
            @{Html.RenderAction("NewMalzemeForm", new { id = ViewBag.IrsaliyeId });}
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.MalKodu</td>
                    <td>@item.MalAdi</td>
                    <td>@item.Miktar</td>
                    <td>@item.Birim</td>
                    <td>
                        <a class="edit" href="javascript:;" onclick="CreateEdit('@item.ID')"> Düzenle </a>
                        <a class="edit" href="javascript:;" onclick="Delete('@item.ID','/Storage/StoreGridPartial','StoreGrid','0')"> Sil </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
<link href="~/Content/assets/global/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Content/assets/global/plugins/jquery/jquery-3.1.1.min.js"></script>
<script src="~/Content/assets/global/plugins/jquery-ui/jquery-ui.min.js"></script>
<script>
    $("#MalKodu").autocomplete({
        source: "/Buy/getMalzemebyCode/",
        minLength: 2,
        select: function (event, ui) {
            $("#MalKodu").val(ui.item.id);
            $("#MalAdi").val(ui.item.value);
            getBirims(ui.item.id);
        }
    });
    $("#MalAdi").autocomplete({
        source: "/Buy/getMalzemebyName/",
        minLength: 2,
        select: function (event, ui) {
            $("#MalKodu").val(ui.item.id);
            $("#MalAdi").val(ui.item.value);
            getBirims(ui.item.id);
        }
    });
    function getBirims(id)
    {
        $("#Birim option").remove();
        $.ajax({
            url: "/Buy/getBirim",
            type: 'POST',
            data: JSON.stringify({ kod: id }),
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data != "") {
                    $.each(data, function (i, item) {
                        $('#Birim').append($('<option>', { value: item, text: item }));
                    });
                }
            }
        });
    }
</script>