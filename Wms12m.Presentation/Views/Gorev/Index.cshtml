@model List<Gorev>
@{
    ViewBag.Title = "Gorev Listesi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}@section Styles{<link href="@Url.Content("~/Content/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.min.css")" rel="stylesheet" type="text/css" />
<style>
    td.details-control {background: url('/Content/assets/global/plugins/datatables/images/details_open.png') no-repeat center center;cursor: pointer;}
    tr.shown td.details-control {background: url('/Content/assets/global/plugins/datatables/images/details_close.png') no-repeat center center;}
</style>
}<h3 class="page-title">Görev İşlemleri</h3>
<div class="row">
    <div class="col-md-12">
        <div id="CreateEdit"></div>
        <div>
            <div class="portlet box green">
                <div class="portlet-title">
                    <div class="caption">
                        <i class="fa fa-gift"></i>Görev Listesi
                    </div>
                </div>
                <div class="portlet-body form">
                    <div id="GorevGrid" class="p-30">
                        <table class="table table-striped table-bordered" id="sample_1">
                            <thead><tr><th></th><th>Depo</th><th>EvrakNo</th><th>Görev No</th><th>Görev Tipi</th><th>Durum</th><th>Görevli</th><th>Oluşturma Tarihi</th><th>Bitirme Tarihi</th><th></th></tr></thead>
                            <tbody id="GorevFrom">
                                @foreach (var item in Model)
                                {
                                    <tr data-ID="@item.ID">
                                        <td class="details-control"></td>
                                        <td>@item.Depo.DepoAd</td>
                                        <td>@{if (item.IR != null ) { @item.IR.EvrakNo } }</td>
                                        <td>@item.GorevNo</td>
                                        <td>@item.ComboItem_Name1.Name</td>
                                        <td>@item.ComboItem_Name.Name</td>
                                        <td><a class="btn btn-default input-circle" href="#modalEditPage" data-toggle="modal" onclick="editInModal('/Gorev/GorevliAta/@item.ID')"> @{if (item.User1 != null){ @item.User1.AdSoyad} else {<text>Görevli Ata</text>}} </a></td>
                                        <td>@item.OlusturmaTarihi.FromOADateInt()</td>
                                        <td>@{if (item.BitisTarihi != null) { @item.BitisTarihi.Value.FromOADateInt() } }</td>
                                        <td>
                                            <a class="btn btn-default input-circle" href="javascript:;" onclick="CreateEdit('@item.ID')"> Düzenle </a>
                                            <a class="btn btn-danger input-circle" href="javascript:;" onclick="Delete('@item.ID','','','')"> Sil </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{
<script src="~/Content/assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script type="text/javascript">
    function newrow(id)
    {
        return "<table style='background:transparent;' id='new"+id+"'></table>";
    }
    function format(d) {
        var html = "";
        $.ajax({
            type: 'POST',
            url: '/Gorev/Details',
            data: { "ID": d },
            dataType: "json",
            success: function (data) {
                html += (data.EvrakNo === null ? "" : '<tr style="background:transparent;"><td><b>EvrakNo:</b> ' + data.EvrakNo + '</td></tr>');
                html += (data.Gorevli === null ? "" : '<tr style="background:transparent;"><td><b>Görevli:</b> ' + data.Gorevli + '</td></tr>');
                html += (data.Atayan === null ? "" : '<tr style="background:transparent;"><td><b>Atayan:</b> ' + data.Atayan + '</td></tr>');
                html += (data.AtamaTarihi === null ? "" : '<tr style="background:transparent;"><td><b>Atama Tarihi:</b> ' + fromOADate(data.AtamaTarihi) + '</td></tr>');
                html += (data.Olusturan === null ? "" : '<tr style="background:transparent;"><td><b>Oluşturan:</b> ' + data.Olusturan + '</td></tr>');
                html += (data.OlusturmaTarihi === null ? "" : '<tr style="background:transparent;"><td><b>Oluşturma Tarihi:</b> ' + fromOADate(data.OlusturmaTarihi) + '</td></tr>');
                html += (data.OlusturmaSaati === null ? "" : '<tr style="background:transparent;"><td><b>Oluşturma Saati:</b> ' + data.OlusturmaSaati.toString().toHHMMSS() + '</td></tr>');
                html += (data.BitisTarihi === null ? "" : '<tr style="background:transparent;"><td><b>Bitirme Tarihi:</b> ' + fromOADate(data.BitisTarihi) + '</td></tr>');
                html += (data.BitisSaati === null ? "" : '<tr style="background:transparent;"><td><b>Bitirme Saati:</b> ' + data.BitisSaati.toString().toHHMMSS() + '</td></tr>');
                html += (data.Aciklama === null ? "" : '<tr style="background:transparent;"><td><b>Açıklama:</b> ' + data.Aciklama + '</td></tr>');
                html += (data.Bilgi === null ? "" : '<tr style="background:transparent;"><td><b>Bilgi:</b> ' + data.Bilgi + '</td></tr>');
                $('#new' + d).html(html);
            }
        });
    }
    $(document).ready(function () {
        var table = $('#sample_1').DataTable({
            "ordering": false,
            "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" },
            initComplete: function () {
                this.api().columns([1, 2, 3, 4, 5]).every(function () {
                    var column = this;
                    var select = $('<br /><select style="max-width:100px;"><option value=""></option></select>')
                        .appendTo($(column.header()))
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
                    column.data().unique().sort().each(function (d, j) { select.append('<option value="' + d + '">' + d + '</option>') });
                });
            }
        });
        $('#sample_1 tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);
            if (row.child.isShown()) { row.child.hide(); tr.removeClass('shown'); }
            else {
                row.child(newrow(tr.data('id'))).show();
                format(tr.data('id'));
                tr.addClass('shown');
            }
        });
    });
    var GorevGridUrl = '@Url.Action("GorevGridPartial", "Gorev")';
    var GorevDetailUrl = '@Url.Action("GorevDetailPartial", "Gorev")';
    var DeleteFunctionUrl = '@Url.Action("Delete", "Gorev")';
    function CreateEdit(Id) {
        PartialView(GorevDetailUrl, 'CreateEdit', JSON.stringify({ Id: Id == null ? '' : Id }));
        $("#CreateEdit").show();
    }
    function DuzenleIptal() {
        $('#CreateEdit').html('');
        $("#CreateEdit").hide();
    }
</script>
}