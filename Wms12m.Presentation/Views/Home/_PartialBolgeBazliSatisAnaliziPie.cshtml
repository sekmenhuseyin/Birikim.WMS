@model List<ChartBolgeBazliSatisAnalizi>
<div class="row">
    <div class="col-md-12 m-t-40">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-bar-chart font-green-haze"></i>
                    <span class="caption-subject bold uppercase font-green-haze"> Bölge Bazlı Satış Analizi <span style="color:#8888a7;">3D PİE CHART</span></span>
                </div>
                <div class="tools" style="float:right;margin-left:20px;">
                    <a href="javascript:;" class="collapse"> </a>
                    <a href="#portlet-config" data-toggle="modal" class="config"> </a>
                    <a href="javascript:;" class="reload"> </a>
                    <a href="javascript:;" class="fullscreen"> </a>
                    <a href="javascript:;" class="remove"> </a>
                </div>
                <div style="float:right;margin-left:20px;"><div style="float:left;line-height:36px;"> <span style="color:#0c09de;">Ay</span></div> <div class="slct_ay_pie" style="float:left;width:200px; margin-left:10px;"></div></div>
                <div style="float:right;"><div style="float:left;line-height:36px;"> <span style="color:#0c09de;">Kriter </span></div> <div class="slct_kriter_pie" style="float:left;width:200px; margin-left:10px;"></div></div>
            </div>
            <div class="portlet-body">
                <div id="chart_5_bolge_pie" class="chart" style="height: 400px;"> </div>
                <div class="well margin-top-20">
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function (e) {
        var ay_value= @ViewBag.Ay;
        var kriter_value=@Html.Raw(Json.Encode(ViewBag.Kriter));
        var ay = [{ id: 0, state: "Tümü"},{ id: 1, state: "Ocak"},{ id: 2, state: "Şubat" },{ id: 3, state: "Mart"},{ id: 4, state: "Nisan"},{ id: 5, state: "Mayıs" },{ id: 6, state: "Haziran"},{ id: 7, state: "Temmuz"},{ id: 8, state: "Ağustos" },{ id: 9, state: "Eylül"},{ id: 10, state: "Ekim"},{ id: 11, state: "Kasım" },{ id: 12, state: "Aralik"}];
        var kriter = [{ state: "Tüm Bölgeler"},{ state: "Akdeniz Böl."},{ state: "Doğu Anad. Böl." },{ state: "Ege Böl."},{ state: "G.Doğu Anad.Böl."},{ state: "İç Anadolu Böl." },{ state: "Karadeniz Böl."},{ state: "Marmara Böl."}];
        var model = @Html.Raw(Json.Encode(Model));
        var color = ["#FF0F00","#FF6600","#FF9E01","#FCD202","#F8FF01","#B0DE09","#04D215","#0D8ECF","#0D52D1","#2A0CD0","#8A0CCF","#CD0D74","#754DEB","#DDDDDD","#999999","#333333","#000000"];
        for (var i = 0; i < model.length; i++) {
            $.extend(model[i],{
                color: color[i%color.length]
            });
        }
        $(".slct_ay_pie").dxSelectBox({
            dataSource: ay,
            valueExpr: 'id',
            displayExpr: 'state',
            value: ay_value,
            onValueChanged: function (e) {
                ay_value=e.value;
                var BolgeBazliSatisAnaliziPie = "/Home/PartialBolgeBazliSatisAnaliziPie";
                PartialView(BolgeBazliSatisAnaliziPie, 'bolge-bazli-satis-analizi-pie', JSON.stringify({ ay: ay_value, kriter:kriter_value}));
            }
        });
        $(".slct_kriter_pie").dxSelectBox({
            dataSource: kriter,
            valueExpr: 'state',
            displayExpr: 'state',
            value: kriter_value,
            onValueChanged: function (e) {
                kriter_value=e.value;
                var BolgeBazliSatisAnaliziPie = "/Home/PartialBolgeBazliSatisAnaliziPie";
                PartialView(BolgeBazliSatisAnaliziPie, 'bolge-bazli-satis-analizi-pie', JSON.stringify({ ay: ay_value, kriter:kriter_value}));
            }
        });
        var ChartsAmcharts = function () {
            var initChartSample7 = function () {
                var chart = AmCharts.makeChart("chart_5_bolge_pie", {
                    "type": "pie",
                    "theme": "light",
                    "fontFamily": 'Open Sans',
                    "color": '#888',
                    "valueField": "GenelTutar",
                    "titleField": "Lokasyon",
                    "outlineAlpha": 0.4,
                    "depth3D": 30,
                    "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
                    "colorField": "color",
                    "angle": 30,
                    "exportConfig": {
                        menuItems: [{
                            icon: '/lib/3/images/export.png',
                            format: 'png'
                        }]
                    }
                });
                chart.dataProvider = model;
                chart.validateData();
                chart.animateAgain();
                jQuery('.chart_7_chart_input').off().on('input change', function () {
                    var property = jQuery(this).data('property');
                    var target = chart;
                    var value = Number(this.value);
                    chart.startDuration = 0;

                    if (property == 'innerRadius') {
                        value += "%";
                    }

                    target[property] = value;
                    chart.validateNow();
                });

                $('#chart_5_bolge_pie').closest('.portlet').find('.fullscreen').click(function () {
                    chart.invalidateSize();
                });
            }
            return {
                init: function () {
                    initChartSample7();
                }
            };
        }();
        jQuery(document).ready(function () {
            ChartsAmcharts.init();
        });
    });
</script>