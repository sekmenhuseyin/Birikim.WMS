@model IEnumerable<frmSiparisMalzeme>
@{
    ViewBag.Title = "Sipariş Planlama - 2. Adım";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string tmp = "";
}@section Styles{<link href="@Url.Content("~/Content/assets/global/plugins/datatables/datatables.min.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.min.css")" rel="stylesheet" type="text/css" />
}<h3 class="page-title">Sipariş Planlama - 2. Adım</h3>
<div class="row">
    <div class="col-md-12">
        <div class="mt-element-step">
            <div class="row step-background-thin">
                <div class="col-md-4 bg-grey-steel mt-step-col done">
                    <div class="mt-step-number">1</div>
                    <div class="mt-step-title uppercase font-grey-cascade">SİPARİŞ SEÇİMİ</div>
                    <div class="mt-step-content font-grey-cascade">Bir sipariş Seçin</div>
                </div>
                <div class="col-md-4 bg-grey-steel mt-step-col active">
                    <div class="mt-step-number">2</div>
                    <div class="mt-step-title uppercase font-grey-cascade">MALZEME SEÇİMİ</div>
                    <div class="mt-step-content font-grey-cascade">İstenen Malzemeleri Seçin</div>
                </div>
                <div class="col-md-4 bg-grey-steel mt-step-col">
                    <div class="mt-step-number">3</div>
                    <div class="mt-step-title uppercase font-grey-cascade">Onay</div>
                    <div class="mt-step-content font-grey-cascade">Onaylayın</div>
                </div>
            </div>
        </div>
        <div class="portlet box green m-t-30">
            <div class="portlet-title"><div class="caption"><i class="fa fa-gift"></i>Sipariş Seçimi</div></div>
            <div class="portlet-body form p-30">
                @using (Html.BeginForm("Step3", "Sell", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true)
                    <table class="table table-striped table-bordered table-condensed table-hover" id="sample_2">
                        <thead><tr><th>Mal Kodu</th><th>Mal Adı</th><th>Miktar</th><th>Stok</th><th>Birim</th></tr></thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                tmp += item.MalKodu.ClearNonAscii() + "#";
                                <tr style="cursor:pointer;" onclick="toggle(this,'@item.MalKodu.ClearNonAscii()')">
                                    <td>@Html.DisplayFor(modelItem => item.MalKodu)</td>
                                    <td>@Html.DisplayFor(modelItem => item.MalAdi)</td>
                                    <td align="right">@String.Format("{0:n}", item.Miktar)</td>
                                    <td align="right">@String.Format("{0:n}", item.Stok)</td>
                                    <td>@Html.DisplayFor(modelItem => item.Birim)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div class="row m-t-20">
                        <div class="col-md-2">
                            <button class="btn btn-default btn-block" onclick="window.history.back();"><<< Geri</button>
                        </div>
                        <div class="col-md-1 col-md-offset-7">
                            <button type="button" class="btn btn-default m-r-20" id="selector">Hepsini Seç</button>
                        </div>
                        <div class="col-md-2">
                            <input type="hidden" name="DepoID" value="@ViewBag.DepoID" />
                            <input type="hidden" name="EvrakNos" value="@ViewBag.EvrakNos" />
                            <input type="hidden" name="checkboxes" id="checkboxes" value="" />
                            <input type="submit" class="btn btn-primary btn-block green" value="İleri >>>" />
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
@section Scripts{
<script src="~/Content/assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script>
    var selected = ""; var selectall = true;
    $(document).ready(function () {
        var table = $('#sample_2').DataTable({
            "ordering": false,
            "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" },
            initComplete: function () {
                this.api().columns([0, 1]).every(function () {
                    var column = this;
                    var select = $('<br /><select style="max-width:100px;"><option value=""></option></select>')
                        .appendTo($(column.header()))
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
                    column.data().unique().sort().each(function (d, j) { select.append('<option value="' + d + '">' + d + '</option>') });
                });
            }
        });
        $("#selector").click(function () {
            if (selectall == true) {
                selected = "@tmp";
                $("#selector").text("Seçimi İptal Et"); selectall = false;
                table.rows().every(function (rowIdx, tableLoop, rowLoop) { this.select(); });
            }
            else {
                selected = "";
                $("#selector").text("Hepsini Seç"); selectall = true;
                table.rows().every(function (rowIdx, tableLoop, rowLoop) { this.deselect(); });
            }
            $("#checkboxes").val(selected);
        });
    });
    function toggle(row,id) {
        $(row).toggleClass('selected');
        if ($(row).hasClass('selected') == true) selected = selected + id + "#";
        else selected = selected.replace(id + "#", "");
        $("#checkboxes").val(selected);
    }
</script>
}