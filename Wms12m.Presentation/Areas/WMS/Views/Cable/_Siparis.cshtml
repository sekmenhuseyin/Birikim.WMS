@model IEnumerable<frmSiparisler>
<div class="row">
    <div class="col-lg-12 modal-body">
        <table class="table table-striped table-bordered table-condensed" id="sample_2" width="250">
            <thead>
                <tr>
                    <th style="width:20px!important;">&nbsp;</th>
                    <th>Evrak No<br /><input class="w-50 input-circle" type="text" id="EvrakNo" /></th>
                    <th>Tarih<br /><input class="w-50 input-circle" type="text" id="Tarih" /></th>
                    <th>Saat<br /><input class="w-50 input-circle" type="text" id="Saat" /></th>
                    <th>ChK<br /><input class="w-50 input-circle" type="text" id="Chk" /></th>
                    <th>Ünvan<br /><input class="w-50 input-circle" type="text" id="Yer" /></th>
                    <th>Grup Kod<br /><input class="w-50 input-circle" type="text" id="GrupKod" /></th>
                    <th>Fatura Adres<br /><input class="w-50 input-circle" type="text" id="FaturaAdres" /></th>
                    <th>Açıklama<br /><input class="w-50 input-circle" type="text" id="Aciklama" /></th>
                    <th>Çeşit</th>
                    <th class="text-right">Miktar<br /><input class="w-50 input-circle" type="text" id="Miktar" /></th>
                    <th>ID</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr data-ID="@item.SirketID-@ViewBag.Depo-@item.EvrakNo" style="cursor:pointer;" onclick="toggle(this, '@item.SirketID-@item.EvrakNo')">
                        <td style="width:20px!important;" class="details-control"></td>
                        <td>@Html.DisplayFor(modelItem => item.EvrakNo)</td>
                        <td>@item.Tarih.FromOADateInt()</td>
                        <td>@item.Saat.FromOaTime()</td>
                        <td>@Html.DisplayFor(modelItem => item.Chk)</td>
                        <td>@Html.DisplayFor(modelItem => item.Unvan)</td>
                        <td>@Html.DisplayFor(modelItem => item.GrupKod)</td>
                        <td>@Html.DisplayFor(modelItem => item.FaturaAdres)</td>
                        <td>@Html.DisplayFor(modelItem => item.Aciklama)</td>
                        <td align="right">@item.Çeşit</td>
                        <td align="right">@String.Format("{0:n}", item.Miktar)</td>
                        <td>@item.SirketID-@item.EvrakNo</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-md-1 col-md-offset-9">
        <button type="button" class="btn btn-default m-r-20" id="selector">Hepsini Seç</button>
    </div>
    <div class="col-md-2">
        <input type="hidden" name="checkboxes" id="checkboxes" value="" />
        <input type="submit" class="hide hidden" value="submit" name="submit" id="submit" />
        <input type="button" class="btn btn-primary btn-block green submit" value="İleri >>>" />
    </div>
</div>
<script>
    selected = ""; var selectall = true;
    $(document).ready(function () {
        //tarih alanları
        $.datepicker.setDefaults($.datepicker.regional["tr"]);
        $("#EvrakNo").on("change paste keyup", function () { filterx(1, $("#EvrakNo").val()); });
        $("#Tarih").datepicker().on("change", function (e) { filterx(2, e.target.value); });
        $("#Saat").on("change paste keyup", function () { filterx(3, $("#Saat").val()); });
        $("#Chk").on("change paste keyup", function () { filterx(4, $("#Chk").val()); });
        $("#Yer").on("change paste keyup", function () { filterx(5, $("#Yer").val()); });
        $("#GrupKod").on("change paste keyup", function () { filterx(6, $("#GrupKod").val()); });
        $("#FaturaAdres").on("change paste keyup", function () { filterx(7, $("#FaturaAdres").val()); });
        $("#Aciklama").on("change paste keyup", function () { filterx(8, $("#Aciklama").val()); });
        $("#Miktar").on("change paste keyup", function () { filterx(10, $("#Miktar").val()); });
        var table = $('#sample_2').DataTable({
            "pagingType": "full_numbers",
            //"ordering": false,
            "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" },
            "columnDefs": [{ "targets": [11], "visible": false, "searchable": false }]
        });
        function filterx(a, b) { filter(table, a, b); }
        $('#sample_2 tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);
            if (row.child.isShown()) { row.child.hide(); tr.removeClass('shown'); }
            else { row.child(newrow(tr.data('id'))).show(); format(tr.data('id')); tr.addClass('shown'); }
        });
        $("#selector").click(function () {
            selected = "";
            if (selectall == true) {
                $("#selector").text("Seçimi İptal Et"); selectall = false;
                table.rows({ filter: 'applied' }).every(function (rowIdx, tableLoop, rowLoop) {
                    selected = selected + this.data()[11] + "#";
                    this.select();
                });
            }
            else {
                $("#selector").text("Hepsini Seç"); selectall = true;
                table.rows().every(function (rowIdx, tableLoop, rowLoop) { this.deselect(); });
            }
            $("#checkboxes").val(selected);
        });
         $(".submit").click(function () {
            var result = false;
            table.rows(".selected").every(function (rowIdx, tableLoop, rowLoop) {
                result = true;
            });
            if (result == true) $("#submit").click();
            else Modaldialog("Lütfen sipariş seçin", "Hata", "Tamam", "btn-danger");
        });
   });
    function newrow(id) {
        return "<table style='background:transparent;' id='new" + id.replaceAll(" ", "") + "'></table>";
    }
    function format(d) {
        var html = "<tr style='background: transparent;'><th>Mal Kodu</th><th>Mal Adı</th><th>Miktar</th><th>Birim</th><th>Stok</th><th>Durum</th></tr>";
        $.ajax({
            type: 'POST',
            url: '/WMS/Sales/Details',
            data: { "ID": d },
            dataType: "json",
            success: function (data) {
                for (var i in data) {
                    html += '<tr style="background:transparent;"><td>' + data[i].MalKodu + '</td><td>' + data[i].MalAdi + '</td><td align=right>' + data[i].Miktar.formatMoney(2) + '</td><td>' + data[i].Birim + '</td><td align=right>' + data[i].Stok.formatMoney(2) + '</td><td>' + data[i].HucreAd + '</td></tr>';
                };
                $('#new' + d.replaceAll(" ", "")).html(html);
            }
        });
    }
    function toggle(row, id) {
        $(row).toggleClass('selected');
        if ($(row).hasClass('selected') == true) selected = selected + id + "#";
        else selected = selected.replace(id + "#", "");
        $("#checkboxes").val(selected);
    }
</script>