@model Transfer
@{ Result result = ViewBag.Result; string tmp; List<string> Sirket = ViewBag.Sirket; var malkod = new List<String>(); var malad = new List<String>(); }
@if (result.Message != "") { <p class="text-danger"><strong>@Html.Raw(result.Message)</strong></p> }
@using (Ajax.BeginForm("AddDetail", "Transfer", new { area = "WMS" }, new AjaxOptions { OnSuccess = "getResult", OnFailure = "Modaldialog('Lütfen Tekrar Deneyin', 'Hata', 'Tamam', 'btn-danger');" }, new { @id = "frmAddDetay" }))
{
    <input type="hidden" name="Id" value="@Model.ID" />
    <input type="hidden" name="IrsaliyeId" value="@ViewBag.IrsaliyeId" />
    @Html.AntiForgeryToken()
    <table class="table table-striped table-bordered table-condensed">
        <thead><tr><th>Mal Kodu</th><th>Mal Adı</th><th class="text-right">Miktar</th><th>Birim</th><th></th></tr></thead>
        <thead>
            <tr>
                <td><input class="input-circle form-control" type="text" name="MalKodu" id="sMalKodu" /></td>
                <td><input class="input-circle form-control" type="text" name="MalAdi" id="sMalAdi" /></td>
                <td><input class="input-circle form-control pull-right" type="text" name="Miktar" id="sMiktar" /></td>
                <td><select class="input-circle form-control" name="Birim" id="sBirim"><option></option></select></td>
                <td><button type="submit" class="btn btn-primary input-circle">Ekle</button></td>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Transfer_Detay)
            {
                if (malkod.Contains(item.MalKodu) == false)
                {
                    tmp = item.MalKodu.GetMalAdi(Sirket[0]);
                    if (tmp == null || tmp == "") { tmp = item.MalKodu.GetMalAdi(Sirket[1]); }
                    malkod.Add(item.MalKodu);
                    malad.Add(tmp);
                }
                else
                {
                    tmp = malad[malkod.IndexOf(item.MalKodu)];
                }
                <tr id="tr@{@item.ID}">
                    <td>@item.MalKodu</td>
                    <td>@tmp</td>
                    <td class="text-right">@String.Format("{0:n}", item.Miktar)</td>
                    <td>@item.Birim</td>
                    <td>
                        <a href="javascript:;" class="btn btn-default input-circle" onclick="editlist(@item.ID)">Değiştir</a>
                        <a href="javascript:;" class="btn btn-danger input-circle" onclick="Delete('@item.ID','/WMS/Transfer/SummaryList','listSummary','@item.TransferID', '')"> Sil </a>
                    </td>
                </tr>
    }
        </tbody>
    </table>
}
<script>
    $(document).ready(function () {
        $("#sMalKodu").autocomplete({
            source: "/WMS/Purchase/getMalzemebyCode",
            minLength: 2,
            select: function (event, ui) {
                getBirims(ui.item.id);
                $("#sMalAdi").val(ui.item.value);
            },
            open: function () {
                $(this).autocomplete('widget').css('z-index', 1000000000);
                return false;
            }
        });
        $("#sMalAdi").autocomplete({
            source: "/WMS/Purchase/GetMalzemebyName",
            minLength: 2,
            select: function (event, ui) {
                getBirims(ui.item.id);
                $("#sMalAdi").val(ui.item.value);
            },
            open: function () {
                $(this).autocomplete('widget').css('z-index', 1000000000);
                return false;
            }
        });
    });
</script>