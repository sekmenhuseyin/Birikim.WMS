@model List<SMSiparisOnaySelect>
@{
    ViewBag.Title = "SM Sipariş Onay";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="page-bar"><ul class="page-breadcrumb"><li><a href="/">Anasayfa</a><i class="fa fa-circle"></i></li><li></li></ul></div>
<div class="row">
    <div class="col-md-12" style="width:100%;">
        <div class="portlet box green">

            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i>Sipariş Onay SM
                </div>
                <div class="col-md-1 pull-right m-t-5 p-0" id="buttons"></div>
                <div class="col-md-1 pull-right m-t-5" id="SMYenile">
                    <a class="btn btn-default pull-right input-circle 	glyphicon glyphicon-refresh" href="#modalEditPage" data-toggle="modal"> Yenile </a>
                </div>
                <div class="col-md-1 pull-right m-t-5" id="SMOnayla">
                    <a class="btn btn-default pull-right input-circle glyphicon glyphicon-ok" href="#modalEditPage" data-toggle="modal" style="background-color:#40bf40"> Onayla </a>
                </div>
                <div class="col-md-1 pull-right m-t-5" id="SMReddet">
                    <a class="btn btn-default pull-right input-circle glyphicon glyphicon-remove" href="#modalEditPage" data-toggle="modal" style="background-color:#ff4d4d"> Reddet </a>
                </div>
               
            </div>
            <div class="portlet-body">
               
                <table class="table table-striped table-bordered" id="sample_1">
                    <thead>
                        <tr>
                            <th nowrap></th>
                            <th nowrap> Evrak No </th>
                            <th nowrap> Tarih </th>
                            <th nowrap> Hesap Kodu </th>
                            <th nowrap> Ünvan </th>
                            <th nowrap> Teslim Yeri Kodu </th>
                            <th nowrap>Teslim Yeri Ünvan</th>
                            <th nowrap>Sipariş Tutarı</th>
                            <th nowrap>Bakiye</th>
                            <th nowrap>Risk Bakiyesi</th>
                            <th nowrap>Toplam Bakiye</th>
                            <th nowrap>Şahsi Çek Limiti</th>
                            <th nowrap>Şahsi Çek Riski</th>
                            <th nowrap>Müşteri Çek Limiti</th>
                            <th nowrap>Müşteri Çek Riski</th>
                            <th nowrap>Bekleyen Sipariş Tutarı</th>
                            <th nowrap>Teminat</th>
                            <th nowrap>Teminat Alt Bayi</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr onclick="toggle(this, '@item.EvrakNo')">
                                <td nowrap class="select-checkbox"></td>
                                <td nowrap> @item.EvrakNo</td>
                                <td nowrap>@item.Tarih</td>
                                <td nowrap>@item.Chk</td>
                                <td nowrap>@item.Unvan</td>
                                <td nowrap>@item.TeslimYeriKodu</td>
                                <td nowrap>@item.TeslimYeriUnvan</td>
                                <td nowrap align="right">@String.Format("{0:n}", item.SiparisTutari)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.Bakiye)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.RiskBakiyesi)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.ToplamBakiye)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.SahsiCekLimiti)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.SahsiCekRiski)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.MusteriCekLimiti)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.MusteriCekRiski)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.BekleyenSiparisTutari)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.Teminat)<div class="hidden">.</div></td>
                                <td nowrap align="right">@String.Format("{0:n}", item.TeminatAltBayi)<div class="hidden">.</div></td>

                            </tr>
                        }
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>
@section Scripts{
<script>
    var secili_table = new Array();
    $(document).ready(function () {
        table = $('#sample_1').DataTable({ "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" } });

        var buttons = new $.fn.dataTable.Buttons(table, {
            buttons: [
                { "extend": 'pdf', "text": '<span class="fa fa-file-pdf-o" style="font-size:15px;color:red;"></span>', "className": 'btn btn-default btn-xs;' },
                { "extend": 'excel', "text": '<span class="fa fa-file-excel-o" style="font-size:15px;color:green"></span>', "className": 'btn btn-default btn-xs' }
            ]
        }).container().appendTo($('#buttons'));

        $('#SMOnayla').click(function (e) {
            var x = table.rows('.selected').data();
            for (var i = 0; i < x.length; i++) {
                secili_table.push(x[i][1]);
            }
            var _dfd = $.Deferred();
            $.ajax({
                url: window.location.origin + "/Approvals/Order/Onay",
                data: { Data: JSON.stringify(secili_table), OnaylandiMi: true, OnayTip: 1 },
                type: "post",
                success: function (data) {
                    if (data.Status == true) {
                        Modaldialog(data.Message, "Güncelleme İşlemi", "Tamam", "Guncel");
                        setTimeout(function () { window.location.reload(); }, 500);
                    }
                    else {
                        if (data.Message == "") data.Message = "Hata oluştu";
                        Modaldialog(data.Message, "Hata", "Tamam", "btn-danger");
                        setTimeout(function () { window.location.reload(); }, 500);
                    }

                }
            });
            return _dfd.promise();







           
        });
        $('#SMReddet').click(function (e) {

            var x = table.rows('.selected').data();
            for (var i = 0; i < x.length; i++) {
                secili_table.push(x[i][1]);
            }
            var _dfd = $.Deferred();
            $.ajax({
                url: window.location.origin + "/Approvals/Order/Onay",
                data: { Data: JSON.stringify(secili_table), OnaylandiMi: false, OnayTip: 1 },
                type: "post",
                success: function (data) {
                    if (data.Status == true) {
                        Modaldialog(data.Message, "Red İşlemi", "Tamam", "Red");
                        setTimeout(function () { window.location.reload(); }, 500);
                    }
                    else {
                        if (data.Message == "") data.Message = "Hata oluştu";
                        Modaldialog(data.Message, "Hata", "Tamam", "btn-danger");
                        setTimeout(function () { window.location.reload(); }, 500);
                    }
                }
            });
            return _dfd.promise();
        });
        $('#SMYenile').click(function (e) {
            window.location.reload(); 
        });
    });
    function toggle(row, id) {
        $(row).toggleClass('selected');
        setTimeout(function () { $("td").removeClass('sorting_1'); }, 0);
    }
    $('#sample_1').on('draw.dt', function () {
        setTimeout(function () { $("td").removeClass('sorting_1'); }, 0);
    });

</script>
}
