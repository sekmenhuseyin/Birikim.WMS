@model FaturaDetayData
@{
    Setting setts = ViewBag.settings;
    ViewBag.Title = "Fatura Detay";
    Layout = "~/Views/Shared/_Layout.Null.cshtml";
    int ii = 1;
}@section Styles{<link href="~/Content/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
<link href="~/Content/assets/pages/css/invoice.min.css" rel="stylesheet" />
<link href="~/Content/assets/global/plugins/datatables/dataTables.min.css" rel="stylesheet" type="text/css" />
<link href="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.min.css" rel="stylesheet" type="text/css" />
<style>table tr td strong {color: rgba(214, 60, 60, 0.95)}</style>
}<div class="page-bar"></div>
<div style="padding:10px 15px;width:100%;">
    <h1 class="page-title" style="color:rgba(62, 93, 183, 0.89);font-weight:bold;">Fatura Onay<small></small></h1>
    <div class="invoice">
        <div class="row invoice-logo" style="color:#d65252">
            <div class="col-xs-6 invoice-logo-space">
                <img src="~/Content/images/@setts.LoginLogo" class="img-responsive" alt="" />
            </div>
            <div class="col-xs-6" style="color:rgba(13, 166, 191, 0.78);">
                <p>@Model.GENEL[0].EvrakNo / @Model.GENEL[0].Tarih<span class="muted"></span></p>
            </div>
        </div>
        <table class="table">
            <tr>
                <th colspan="3"><h3 class="color-blue-light bold">Hesap Bilgilerim:</h3></th>
                <th colspan="3"><h3 class="color-blue-light bold">İşlem Bilgileri:</h3></th>
                <th colspan="3"><h3 class="color-blue-light bold">Açıklamalar:</h3></th>
                <th colspan="2"><h3 class="color-blue-light bold">E-İhracat Bilgileri:</h3></th>
            </tr>
            <tr>
                <td><strong>Hesap Kodu:</strong></td>
                <td> @Model.GENEL[0].Chk</td>
                <td>&nbsp;</td>
                <td><strong>İşlem Tipi:</strong></td>
                <td> @Model.GENEL[0].IslemTip</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama:</strong></td>
                <td> @Model.GENEL[0].Aciklama</td>
                <td>&nbsp;</td>
                <td><strong>Teslim Şartı:</strong></td>
                <td> @Model.GENEL[0].TeslimSarti</td>
            </tr>
            <tr>
                <td><strong>Ünvan:</strong></td>
                <td> @Model.GENEL[0].Unvan</td>
                <td>&nbsp;</td>
                <td><strong>Vade Tarihi:</strong></td>
                <td> @Model.GENEL[0].VadeTarih</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama2:</strong></td>
                <td> @Model.GENEL[0].Aciklama2</td>
                <td>&nbsp;</td>
                <td><strong>Gönderim Şekli:</strong></td>
                <td> @Model.GENEL[0].GonderimSekli</td>
            </tr>
            <tr>
                <td><strong>Teslim Yeri Kodu:</strong></td>
                <td> @Model.GENEL[0].TeslimYeriKodu</td>
                <td>&nbsp;</td>
                <td><strong>Döviz/TL:</strong> </td>
                <td>@Model.GENEL[0].DvzTL</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama3:</strong></td>
                <td> @Model.GENEL[0].Aciklama3</td>
                <td>&nbsp;</td>
                <td><strong>Brüt Kilo:</strong></td>
                <td> @Model.GENEL[0].BrutKilo</td>
            </tr>
            <tr>
                <td><strong>Teslim Yeri Ünvanı:</strong></td>
                <td> @Model.GENEL[0].TeslimYeriUnvan</td>
                <td>&nbsp;</td>
                <td><strong>Döviz Cinsi:</strong></td>
                <td> @Model.GENEL[0].DovizCinsi</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama4:</strong></td>
                <td> @Model.GENEL[0].Aciklama4</td>
                <td>&nbsp;</td>
                <td><strong>Net Kilo:</strong></td>
                <td> @Model.GENEL[0].NetKilo</td>
            </tr>
            <tr>
                <td><strong>Evrak No:</strong></td>
                <td> @Model.GENEL[0].EvrakNo</td>
                <td>&nbsp;</td>
                <td><strong>Döviz Kuru:</strong></td>
                <td> @Model.GENEL[0].DovizKuru</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama5:</strong></td>
                <td> @Model.GENEL[0].Aciklama5</td>
                <td>&nbsp;</td>
                <td><strong>Ödeme Notu:</strong></td>
                <td> @Model.GENEL[0].OdemeNotu</td>
            </tr>
            <tr>
                <td><strong>Tarih:</strong></td>
                <td> @Model.GENEL[0].Tarih</td>
                <td></td>
                <td><strong>E-Fatura Tipi:</strong></td>
                <td> @Model.GENEL[0].EFatTip</td>
                <td>&nbsp;</td>
                <td><strong>Açıklama6:</strong></td>
                <td> @Model.GENEL[0].Aciklama6</td>
                <td>&nbsp;</td>
                <td><strong>Ödeme Şekli:</strong></td>
                <td> @Model.GENEL[0].OdemeSekli</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><strong>Kaydeden:</strong></td>
                <td> @Model.GENEL[0].Kaydeden</td>
                <td></td>
                <td><strong>Fatura Notu:</strong></td>
                <td> @Model.GENEL[0].EFatNot</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><strong>Değiştiren:</strong></td>
                <td> @Model.GENEL[0].Degistiren</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <div class="row">
            <div class="col-xs-12">
                <table class="table table-striped table-bordered table-condensed" id="sample_1">
                    <thead>
                        <tr style="background-color: #32c5d2;color:rgba(247, 238, 238, 0.85);">
                            <th> # </th>
                            <th> Mal Kodu </th>
                            <th> Mal Adı </th>
                            <th> Birim </th>
                            <th> Birim Miktar </th>
                            <th> Birim Fiyat </th>
                            <th> Tutar </th>
                            <th> Depo </th>
                            <th> KDV Oranı </th>
                            <th> KDV Muafiyet Nedeni </th>
                            <th> Döviz/TL </th>
                            <th> Döviz Cinsi </th>
                            <th> Döviz Kuru </th>
                            <th> Döviz Tutar </th>
                            <th> İskonto 1 </th>
                            <th> İskonto 2 </th>
                            <th> İskonto 3 </th>
                            <th> İskonto 4 </th>
                            <th> İskonto 5 </th>
                            <th> Net Tutar </th>
                            <th> Nesne1 </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.STI)
                        {
                            <tr>
                                <td> @ii </td>
                                <td> @item.MalKodu </td>
                                <td nowrap> @item.MalAdi  </td>
                                <td> @item.Birim  </td>
                                <td align="right"> @item.BirimMiktar  </td>
                                <td align="right"> @item.BirimFiyat  </td>
                                <td align="right"> @item.Tutar  </td>
                                <td> @item.Depo  </td>
                                <td align="right"> @item.KdvOran  </td>
                                <td align="right"> @item.KdvMuafiyetNedeni  </td>
                                <td> @item.DvzTL  </td>
                                <td> @item.DovizCinsi  </td>
                                <td align="right"> @item.DovizKuru  </td>
                                <td align="right"> @item.DovizTutar  </td>
                                <td align="right"> @item.IskontoOran1  </td>
                                <td align="right"> @item.IskontoOran2  </td>
                                <td align="right"> @item.IskontoOran3  </td>
                                <td align="right"> @item.IskontoOran4  </td>
                                <td align="right"> @item.IskontoOran5  </td>
                                <td align="right"> @item.NetTutar  </td>
                                <td> @item.Nesne1  </td>
                            </tr>
                            ii++;
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row m-t-20">
            <div class="col-xs-2 col-sm-2 text-center">
                <div class="btn btn-block green onayla-buton m-b-10">Onayla<i class="fa fa-check"></i></div>
                <div class="btn btn-block red red-buton m-b-10">Reddet<i class="fa fa-close"></i></div>
                <div class="btn btn-block default geri-buton m-b-10">Geri Dön<i class="fa fa-mail-reply"></i></div>
            </div>
            <div class="col-xs-10 col-sm-10">
                <table class="table m-t-0">
                    <tr>
                        <th></th>
                        <th class="text-right">Oran</th>
                        <th class="text-right">Tutar</th>
                        <th class="text-right">Döviz/TL</th>
                        <th>Döviz Cinsi</th>
                        <th class="text-right">Döviz Kuru</th>
                        <th class="text-right">Döviz Tutar</th>
                    </tr>
                    @foreach (var item in Model.FTD)
                    {
                        <tr>
                            <td class="col-xs-3 col-sm-3 text-right bold">@item.Tip</td>
                            <td class="col-xs-1 col-sm-1 text-right">@item.IskontoOran</td>
                            <td class="col-xs-1 col-sm-1 text-right">@item.Iskonto</td>
                            <td class="col-xs-1 col-sm-1 text-right">@item.DvzTL</td>
                            <td class="col-xs-1 col-sm-1 ">@item.DovizCinsi</td>
                            <td class="col-xs-1 col-sm-1 text-right">@item.DovizKuru</td>
                            <td class="col-xs-1 col-sm-1 text-right">@item.DovizTutar</td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="x-modal-faturared" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" style="color:#3434cb">Fatura Onay Red</h4>
                </div>
                <div class="modal-body x-padding-inside" id="x-t-s-pe1">
                    <div class="redNeden">
                        <div style="width:100%;">
                            <h5 style="color:#de3838;">
                                Red Nedeni
                            </h5>
                        </div>
                        <div class="txtRedNeden">

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="mdlSilKapat">Kapat</button>
                    <button type="button" class="btn btn-primary" id="mdlSilKayit" data-dismiss="modal">Kaydet</button>
                    <div class="label"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{<script src="~/Content/assets/global/plugins/moment/moment.min.js"></script>
<script src="~/Content/assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/dataTables.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/scripts/datatable.min.js" type="text/javascript"></script>
<script src="~/Content/assets/global/plugins/DevExtreme/js/dx.web.js" type="text/javascript"></script>
<script type="text/javascript">
    var f_evrakNo = '@ViewBag.EvrakNo';
    var f_chk= '@Model.GENEL[0].Chk';
    var f_tarih='@Model.GENEL[0].Tarih';
    var check_sum = new Array();

    var model = @Html.Raw(Json.Encode(Model));

    for (var i = 0; i < model.STI.length; i++) {
        check_sum.push(model.STI[i].CheckSum);
    }
    var sayac = 1;
    $('#sample_1').DataTable({
        "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" }
    });
    $(document).on("ready", function () {
        $(".txtRedNeden").dxTextArea({ placeholder: 'Açıklama girin', height: 150, maxLength: '128' });
    });
    $(document).on("click", ".geri-buton", function () {
        window.location.href = '/Approvals/Invoice';
    });
    $(document).on("click", ".onayla-buton", function () {
        ModalYesNoClick("Onaylamak istediğinize emin misiniz?", "Onay Uyarı", "Onayla", "btn-primary", Onayla, "İptal", "btn-danger", null);
    });
    function Onayla() {
        var _dfd = $.Deferred();
        $.ajax({
            url: window.location.origin + "/Approvals/Invoice/Onay",
            data: JSON.stringify({ EvrakNo: f_evrakNo, CHK: f_chk, Tarih: f_tarih, ChckSm: check_sum }),
            contentType: "application/json",
            type: "post",
            success: function (data) {
                if (data == "YES") {
                    Modaldialog("İşlem Başarılı.", "Güncelleme İşlemi", "Tamam", "btn-success");
                    setTimeout(function () { window.location.href = '/Approvals/Invoice'; }, 500);
                }
                else if (data == "NO") {
                    Modaldialog("Kayıt sırasında hata oluştu. İşleminiz gerçekleştirilemedi.", "Güncelleme İşlemi", "Tamam", "btn-danger");
                }
                else if (data == "DEGISIM") {
                    Modaldialog("Faturada değişiklik tespit edildi. Fatura Durumu : Onay Bekliyor", "Güncelleme İşlemi", "Tamam", "btn-danger");
                }
                else {
                    Modaldialog("Kayıt sırasında hata oluştu. İşleminiz gerçekleştirilemedi.", "Güncelleme İşlemi", "Tamam", "btn-danger");
                }
            }
        });
        return _dfd.promise();
    }
    $(document).on("click", ".red-buton", function () {
        $(".rdgrpSil").dxRadioGroup({
            value: "Silme"
        });
        $('#x-modal-faturared').modal("show");
    });
    $(document).on("click", "#mdlSilKayit", function () {
        ModalYesNoClick("Reddetmek istediğinize emin misiniz?", "Red Uyarı", "Reddet", "btn-primary", Red, "İptal", "btn-danger", null);
    });
    function Red() {
        var _dfd = $.Deferred();
        var f_redNeden;
        f_redNeden = $(".txtRedNeden").dxTextArea("instance").option("value");
        $.ajax({
            url: window.location.origin + "/Approvals/Invoice/Red",
            data: JSON.stringify({ EvrakNo: f_evrakNo, CHK: f_chk, Tarih: f_tarih, RedNeden: f_redNeden, ChckSm: check_sum }),
            type: "post",
            success: function (data) {

                if (data == "NO") {
                    Modaldialog("Kayıt sırasında hata oluştu. İşleminiz gerçekleştirilemedi.", "Güncelleme İşlemi", "Tamam", "btn-dange");
                }
                else if (data == "DEGISIM") {
                    Modaldialog("Faturada değişiklik tespit edildi. Fatura Durumu : Onay Bekliyor", "Güncelleme İşlemi", "Tamam", "btn-dange");
                }
                else {
                    Modaldialog("İşlem Başarılı", "Güncelleme İşlemi", "Tamam", "btn-dange");
                    setTimeout(function () { window.location.href = '/Approvals/Invoice';}, 500);
                }
            }
        });
        return _dfd.promise();
    }
</script>
}