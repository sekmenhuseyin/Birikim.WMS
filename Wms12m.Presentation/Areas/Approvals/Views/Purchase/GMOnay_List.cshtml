@using Newtonsoft.Json;
<div class="satinalma_gm_onay_data" style="width: 100%; box-shadow: 2px 4px 2px #5d5959;">
    <div class="col-md-12" style="width:100%;">
        <div class="portlet box green">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i>Satınalma GM Onay
                </div>
                <div class="col-md-1 pull-right m-t-5 p-0" id="buttons"></div>
            </div>

            <div class="portlet-body">
           
                <div class="row">
                    <div class="col-xs-12">
                        <table class="table table-striped table-bordered" id="sample_1">
                            <thead class="aaaaa">
                                <tr>
                                    <th nowrap>Mal Kodu</th>
                                    <th nowrap>Mal Adi</th>
                                    <th nowrap>Birim</th>
                                    <th nowrap>Talep Açıklaması</th>
                                    <th nowrap>Teklif Açıklaması</th>
                                    <th nowrap>Birim Miktar</th>
                                    <th nowrap>Birim Fiyat</th>
                                    <th nowrap>Tutar</th>
                                    <th nowrap>Döviz Tutar</th>
                                    <th nowrap>KDV Oran</th>
                                    <th nowrap>KDV</th>
                                    <th nowrap>Dvz Birim Fiyat</th>
                                    <th nowrap>Dvz Cinsi</th>
                                    <th nowrap>Dvz Kuru</th>
                                    <th nowrap>Vade</th>
                                    <th nowrap>Talep Eden</th>
                                    <th nowrap>Tesis Kodu</th>
                                    <th nowrap>Satın Almacı</th>


                                    <th>Row_ID</th>
                                    <th>Sira No</th>
                                    <th>Depo</th>
                                    <th>Miktar</th>
                                    <th>Fiyat</th>
                                    <th>Iskonto 1</th>
                                    <th>Iskonto 2</th>
                                    <th>Iskonto 3</th>
                                    <th>Iskonto 4</th>
                                    <th>Iskonto 5</th>
                                    <th>Toplam Iskonto</th>
                                    <th>Teslim Miktar</th>
                                    <th>Kapatilan Miktar</th>
                                    <th>Siparis Durumu</th>
                                    <th>Teslim Tarihi</th>
                                    <th>Operator</th>
                                    <th>KatSayi</th>
                                    <th>IslemTip</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th colspan="5"></th>
                                    <th class="text-right"></th>
                                    <th class="text-right"></th>
                                    <th class="text-right"></th>
                                    <th colspan="2"></th>
                                    <th class="text-right"></th>
                                    <th colspan="7"></th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var ch = JSON.parse('@Html.Raw(ViewBag.HesapKodu)');
    var BirimMiktar = 0, Tutar = 0, KDV = 0;
    var table = $('#sample_1').DataTable({
        "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" },
        "ajax": {
            "url": '/Approvals/Purchase/SipGMOnayListData',
            "data": {HesapKodu:ch, SipTalepNo:'@ViewBag.SipTalepNo'},
            "dataSrc": function (json) {
                jQuery.each(json, function (i, val) {
                    BirimMiktar += val.BirimMiktar;
                    Tutar += val.Tutar;
                    KDV += val.KDV;
                });
                return json;
            },
        },
        "fixedHeader": true,
        "scrollX": true,
        "columnDefs": [{ "visible": false, "targets": [18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35] }, { "type": "num-fmt", "className": "dt-right", "targets": [5, 6, 7, 8, 10, 11, 13] }],
        "columns": [
            { "data": "MalKodu" },
            { "data": "MalAdi" },
            { "data": "Birim" },
            { "data": "Aciklama" },
            { "data": "TeklifAciklamasi" },
            { "data": "BirimMiktar", "render": $.fn.dataTable.render.number('.', ',', 2, '')   },
            { "data": "BirimFiyat", "render": $.fn.dataTable.render.number('.', ',', 6, '')   },
            { "data": "Tutar", "render": $.fn.dataTable.render.number('.', ',', 2, '')   },
            { "data": "DovizTutar", "render": $.fn.dataTable.render.number('.', ',', 2, '')   },
            { "data": "KDVOran" },
            { "data": "KDV", "render": $.fn.dataTable.render.number('.', ',', 2, '')   },
            { "data": "DvzBirimFiyat", "render": $.fn.dataTable.render.number('.', ',', 6, '')   },
            { "data": "DovizCinsi" },
            { "data": "DovizKuru", "render": $.fn.dataTable.render.number('.', ',', 6, '')   },
            { "data": "Kod11" },
            { "data": "Kaydeden" },
            { "data": "Nesne3" },
            { "data": "SatinAlmaci" },


            { "data": "ROW_ID" },
            { "data": "SiraNo" },
            { "data": "Depo" },
            { "data": "Miktar" },
            { "data": "Fiyat" },
            { "data": "IskontoOran1" },
            { "data": "IskontoOran2" },
            { "data": "IskontoOran3" },
            { "data": "IskontoOran4" },
            { "data": "IskontoOran5" },
            { "data": "ToplamIskonto" },
            { "data": "TeslimMiktar" },
            { "data": "KapatilanMiktar" },
            { "data": "SiparisDurumu" },
            { "data": "TahTeslimTarih" },
            { "data": "Operator" },
            { "data": "Katsayi" },
            { "data": "IslemTip" }

        ],
        "ordering": false,
        "fnRowCallback": function (nRow, aData, iDisplayIndex) {
            $('td', nRow).attr('nowrap', 'nowrap');
            return nRow;
        },
        "footerCallback": function (row, data, start, end, display) {

                    var api = this.api(), data;

                    $(api.column(5).footer()).html(
                        ondalikBinlik(Math.round(BirimMiktar * 100) / 100, 2)
                    );
                    $(api.column(7).footer()).html(
                        ondalikBinlik(Math.round(Tutar * 100) / 100, 2)
                    );
                    $(api.column(10).footer()).html(
                        ondalikBinlik(Math.round(KDV * 100) / 100, 2)
                    );
        }

     });
    $.contextMenu({
        selector: '#sample_1 tbody tr',
        callback: function (key, options) {
            var rowIndex = parseInt(options.$trigger[0].rowIndex) - 1;
            var satir = table.row(rowIndex).data();
            MLK = satir.MalKodu;
            MLA = satir.MalAdi;
            switch (key) {
                case 'teklif':
                    $('#modalEditPage').modal('toggle');
                    editInModal('/Approvals/Purchase/SatGMContext/teklif')
                    break;
                case 'tedarikci':
                    $('#modalEditPage').modal('toggle');
                    editInModal('/Approvals/Purchase/SatGMContext/tedarikci')
                    break;
                case 'sonalim':
                    $('#modalEditPage').modal('toggle');
                    editInModal('/Approvals/Purchase/SatGMContext/sonalim')
                    break;
                default:
                    break;
            }
        },
        items: {
            "teklif": { name: "Teklif Listesi", icon: "file" },
            "tedarikci": { name: "Onaylı Tedarikçi Listesi", icon: "file" },
            "sonalim": { name: "Son Alım Listesi", icon: "file" },
        }
    });



    $(document).ready(function () {
        var buttons = new $.fn.dataTable.Buttons(table, {
            buttons: [
                { "extend": 'pdf', "text": '<span class="fa fa-file-pdf-o f-s-15 red"></span>', "className": 'btn btn-default btn-xs;' },
                { "extend": 'excel', "text": '<span class="fa fa-file-excel-o f-s-15 green"></span>', "className": 'btn btn-default btn-xs;' }
            ]
        }).container().appendTo($('#buttons'));

    });

</script>