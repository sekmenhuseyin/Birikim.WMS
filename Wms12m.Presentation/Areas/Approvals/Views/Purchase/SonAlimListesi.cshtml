@model IEnumerable<SonAlimListesi>
@{
    System.Web.Script.Serialization.JavaScriptSerializer serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
    serializer.MaxJsonLength = Int32.MaxValue;
}<div class="portlet box green">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-gift"></i>Son Alım Listesi
        </div>
    </div>
    <div class="portlet-body form p-40">
        <table class="table table-striped table-bordered" id="@ViewBag.id">
            <thead>
                <tr>
                    <th nowrap>
                        Evrak No
                    </th>
                    <th nowrap>
                        Tarih
                    </th>
                    <th nowrap>
                        Hesap Kodu
                    </th>
                    <th nowrap>
                        Ünvan
                    </th>
                    <th nowrap>
                        Birim
                    </th>
                    <th nowrap>
                        Birim Miktar
                    </th>
                    <th nowrap>
                        Birim Fiyat
                    </th>
                    <th nowrap>
                        Tutar
                    </th>
                    <th nowrap>
                        Dvz Birim Fiyat
                    </th>
                    <th nowrap>
                        Dvz Tutar
                    </th>
                    <th nowrap>
                        Dvz Kuru
                    </th>
                    <th nowrap style="display:none;">
                        Mal Kodu
                    </th>
                    <th nowrap style="display:none;">
                        Mal Adı
                    </th>
                </tr>

            </thead>
            <tfoot>
                <tr>
                    <th colspan="5"></th>
                    <th class="text-right"></th>
                    <th class="text-right"></th>
                    <th class="text-right"></th>
                    <th class="text-right"></th>
                    <th class="text-right"></th>
                    <th></th>
                </tr>
            </tfoot>
            <tbody>

                @foreach (var item in Model)
                {
                    <tr>
                        <td nowrap>
                            @item.EvrakNo
                        </td>
                        <td nowrap>
                            @item.Tarih_D.ToString("dd/MM/yyyy")
                        </td>
                        <td nowrap>
                            @item.Chk
                        </td>
                        <td nowrap>
                            @item.Unvan
                        </td>
                        <td nowrap>
                            @item.Birim
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.BirimMiktar).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.BirimFiyat).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.Tutar).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.DvzBirimFiyat).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.DovizTutar).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap align="right">
                            @String.Format("{0:0.00}", item.DovizKuru).ToDecimal().ToOnFormat()
                        </td>
                        <td nowrap style="display:none;">
                            @item.MalKodu
                        </td>
                        <td nowrap style="display:none;">
                            @item.MalAdi
                        </td>
                    </tr>
                }
            </tbody>

        </table>
    </div>
</div>

<script>
    $(document).ready(function () {
            var model =  @Html.Raw(serializer.Serialize(Model));
    var BirimMiktar = 0, Tutar = 0, DovizTutar = 0;
    jQuery.each(model, function (i, val) {
        BirimMiktar += val.BirimMiktar;
        Tutar += val.Tutar;
        DovizTutar = val.DovizTutar;
    });
    $('#@ViewBag.id').DataTable({
        "pagingType": "full_numbers",
        "language": { "url": "http://cdn.datatables.net/plug-ins/1.10.13/i18n/Turkish.json" },
        "footerCallback": function (row, data, start, end, display) {

            var api = this.api(), data;


            // Update footer
            $(api.column(5).footer()).html(
                ondalikBinlik(Math.round(BirimMiktar * 100) / 100, 2)
            );
            $(api.column(7).footer()).html(
                ondalikBinlik(Math.round(Tutar * 100) / 100, 2)
            );
            $(api.column(9).footer()).html(
                ondalikBinlik(Math.round(DovizTutar * 100) / 100, 2)
            );
        }
    });
});</script>


